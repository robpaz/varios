<!DOCTYPE html>
<html lang="es" data-bs-theme="light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lección - SUMAJ MAKI</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #0ea5e9;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        [data-bs-theme="dark"] body {
            background-color: #0f172a;
        }

        /* Navbar reuse */
        .navbar {
            background-color: white;
            border-bottom: 1px solid #e2e8f0;
            height: 80px;
        }

        [data-bs-theme="dark"] .navbar {
            background-color: #1e293b;
            border-bottom: 1px solid #334155;
        }

        .content-container {
            max-width: 860px;
            margin: 0 auto;
        }

        .hero-image {
            height: 320px;
            background-size: cover;
            background-position: center;
            border-radius: 0.75rem;
            position: relative;
            overflow: hidden;
        }

        .key-points-card {
            background-color: rgba(14, 165, 233, 0.1);
            border: 1px solid rgba(14, 165, 233, 0.2);
            border-radius: 0.75rem;
        }

        [data-bs-theme="dark"] .key-points-card {
            background-color: rgba(14, 165, 233, 0.05);
        }

        .chart-card {
            background-color: white;
            border: 1px solid #e2e8f0;
            border-radius: 0.75rem;
        }

        [data-bs-theme="dark"] .chart-card {
            background-color: #1e293b;
            border-color: #334155;
        }

        .bottom-nav {
            background-color: white;
            border-top: 1px solid #e2e8f0;
            position: sticky;
            bottom: 0;
            border-radius: 0.75rem 0.75rem 0 0;
            box-shadow: 0 -4px 6px -1px rgba(0, 0, 0, 0.05);
        }

        [data-bs-theme="dark"] .bottom-nav {
            background-color: #1e293b;
            border-color: #334155;
        }

        /* Typography overrides */
        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            color: #111518;
        }

        [data-bs-theme="dark"] h1,
        [data-bs-theme="dark"] h2,
        [data-bs-theme="dark"] h3,
        [data-bs-theme="dark"] h4,
        [data-bs-theme="dark"] h5,
        [data-bs-theme="dark"] h6 {
            color: white;
        }

        p {
            color: #64748b;
        }

        [data-bs-theme="dark"] p {
            color: #94a3b8;
        }

        .text-body-strong {
            color: #111518;
        }

        [data-bs-theme="dark"] .text-body-strong {
            color: #e2e8f0;
        }

        .prose p {
            line-height: 1.75;
            margin-bottom: 1.25em;
            font-size: 1.125rem;
        }
    </style>
</head>

<body>

    <nav class="navbar navbar-expand-lg sticky-top z-3">
        <div class="container-fluid px-4 px-lg-5">
            <a class="navbar-brand d-flex align-items-center gap-3" href="index.html">
                <img src="images/logo.png" alt="Logo" height="70">
                <div class="d-flex flex-column">
                    <span class="fw-bold lh-1 text-dark dark:text-light" style="font-size: 1.25rem;">SUMAJ MAKI</span>
                    <span class="text-secondary fw-bold" style="font-size: 0.65rem;">FUNDACIÓN MULTIDISCIPLINARIA</span>
                </div>
            </a>

            <button class="navbar-toggler ms-auto d-lg-none" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarNav">
                <i class="ph ph-list"></i>
            </button>

            <div class="collapse navbar-collapse" id="navbarNav">
                <div class="d-flex align-items-center gap-3 ms-auto mt-3 mt-lg-0">
                    <a href="courses.html"
                        class="btn btn-link text-decoration-none text-secondary d-flex align-items-center gap-2">
                        <i class="ph ph-book-open" style="font-size: 1.5rem;"></i>
                        <span>Tabla de Contenidos</span>
                    </a>
                    <a href="ai-tools.html"
                        class="btn btn-link text-decoration-none text-secondary d-flex align-items-center gap-2">
                        <i class="ph ph-sparkle" style="font-size: 1.5rem;"></i>
                        <span>Herramientas IA</span>
                    </a>
                    <button class="btn btn-light rounded-circle p-2" id="themeToggle">
                        <i class="ph ph-moon" id="themeIcon" style="font-size: 1.5rem;"></i>
                    </button>
                    <div class="rounded-circle bg-secondary-subtle d-flex align-items-center justify-content-center"
                        style="width: 40px; height: 40px;">
                        <i class="ph ph-user text-secondary"></i>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <main class="flex-grow-1 px-4 py-5 w-100 d-flex flex-column align-items-center">
        <div class="content-container w-100 d-flex flex-column gap-4" id="lessonContainer">

            <!-- Breadcrumbs -->
            <div class="d-flex align-items-center gap-2 text-secondary small">
                <a href="courses.html" class="text-decoration-none text-secondary">Cursos</a>
                <i class="ph ph-caret-right"></i>
                <span id="moduleBreadcrumb">...</span>
            </div>

            <!-- Heading -->
            <div>
                <h1 class="display-5 fw-bold mb-2" id="lessonTitle">Cargando...</h1>
                <p class="fs-5 text-secondary" id="lessonSubtitle">...</p>
            </div>

            <!-- Text Content -->
            <div class="prose text-body-strong" id="lessonContent">
                <p>Cargando contenido del módulo...</p>
            </div>

            <!-- Key Points -->
            <div class="key-points-card p-4 p-md-5">
                <div class="d-flex align-items-center gap-3 mb-4">
                    <i class="ph ph-lightbulb text-primary fs-2"></i>
                    <h3 class="h4 fw-bold mb-0" id="boxTitle">Resultados de Aprendizaje</h3>
                </div>
                <ul class="list-unstyled d-flex flex-column gap-3 mb-0" id="outcomesList">
                    <!-- Outcomes -->
                </ul>
            </div>

            <!-- Chart removed or made static if not relevant to dynamic logic, keeping it simple for now or showing if available -->
        </div>

        <!-- Bottom Nav -->
        <div class="bottom-nav p-3 w-100 mt-5" style="max-width: 1000px;">
            <div class="d-flex flex-column flex-md-row align-items-center justify-content-between gap-3">
                <a href="courses.html" id="prevBtn"
                    class="btn btn-outline-secondary d-flex align-items-center justify-content-center gap-2 px-4 py-2 w-100 w-md-auto fw-bold">
                    <i class="ph ph-arrow-left"></i> Volver al Índice
                </a>

                <button id="nextBtn"
                    class="btn btn-primary d-flex align-items-center justify-content-center gap-2 px-4 py-2 w-100 w-md-auto fw-bold shadow-sm">
                    Siguiente Módulo <i class="ph ph-arrow-right"></i>
                </button>
            </div>
        </div>

    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const themeToggle = document.getElementById('themeToggle');
        const themeIcon = document.getElementById('themeIcon');
        const html = document.documentElement;

        if (html.getAttribute('data-bs-theme') !== 'dark' && localStorage.getItem('theme') === 'dark') {
            html.setAttribute('data-bs-theme', 'dark');
            themeIcon.classList.replace('ph-moon', 'ph-sun');
        }

        themeToggle.addEventListener('click', () => {
            const currentTheme = html.getAttribute('data-bs-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            html.setAttribute('data-bs-theme', newTheme);
            localStorage.setItem('theme', newTheme);

            if (newTheme === 'dark') {
                themeIcon.classList.replace('ph-moon', 'ph-sun');
            } else {
                themeIcon.classList.replace('ph-sun', 'ph-moon');
            }
        });

        // Dynamic Lesson Logic
        document.addEventListener('DOMContentLoaded', async () => {
            const urlParams = new URLSearchParams(window.location.search);
            const moduleId = urlParams.get('module');

            try {
                const response = await fetch('docs/curso.json');
                const data = await response.json();

                // Find module
                const module = data.modules.find(m => m.id === moduleId) || data.modules[0];

                // Update UI
                document.getElementById('moduleBreadcrumb').textContent = module.id;
                document.getElementById('lessonTitle').textContent = module.title;
                document.getElementById('lessonSubtitle').textContent = `Duración estimada: ${module.estimatedHours} horas`;

                // Content (Topics)
                let contentHTML = '<p>Temas a tratar en este módulo:</p><ul class="mb-4">';
                module.topics.forEach(t => contentHTML += `<li>${t}</li>`);
                contentHTML += '</ul>';

                if (module.workshop) {
                    contentHTML += `<h4>Actividad Práctica: ${module.workshop.title}</h4>`;
                    if (module.workshop.tasks) {
                        contentHTML += '<ul>';
                        module.workshop.tasks.forEach(task => contentHTML += `<li>${task}</li>`);
                        contentHTML += '</ul>';
                    }
                }
                if (module.simulation) {
                    contentHTML += `<h4>Simulación: ${module.simulation.title}</h4>`;
                }

                document.getElementById('lessonContent').innerHTML = contentHTML;

                // Outcomes
                const outcomesList = document.getElementById('outcomesList');
                outcomesList.innerHTML = '';
                if (module.outcomes) {
                    module.outcomes.forEach(outcome => {
                        const li = document.createElement('li');
                        li.className = 'd-flex align-items-start gap-3';
                        li.innerHTML = `
                            <i class="ph ph-check-circle text-primary fs-5 mt-1 flex-shrink-0"></i>
                            <span class="text-body-strong">${outcome}</span>
                        `;
                        outcomesList.appendChild(li);
                    });
                }

                // Navigation Logic
                const currentIndex = data.modules.findIndex(m => m.id === module.id);
                const prevBtn = document.getElementById('prevBtn');
                const nextBtn = document.getElementById('nextBtn');

                // Previous
                if (currentIndex > 0) {
                    const prevModule = data.modules[currentIndex - 1];
                    prevBtn.href = `lesson.html?module=${prevModule.id}`;
                    prevBtn.innerHTML = `<i class="ph ph-arrow-left"></i> Anterior: ${prevModule.id}`;
                } else {
                    prevBtn.href = 'courses.html';
                    prevBtn.innerHTML = `<i class="ph ph-arrow-left"></i> Volver al Índice`;
                }

                // Next
                if (currentIndex < data.modules.length - 1) {
                    const nextModule = data.modules[currentIndex + 1];
                    nextBtn.onclick = () => {
                        // Save progress
                        const savedProgress = JSON.parse(localStorage.getItem('courseProgress') || '[]');
                        if (!savedProgress.includes(module.id)) {
                            savedProgress.push(module.id);
                            localStorage.setItem('courseProgress', JSON.stringify(savedProgress));
                        }
                        window.location.href = `lesson.html?module=${nextModule.id}`;
                    };
                    nextBtn.innerHTML = `Siguiente: ${nextModule.id} <i class="ph ph-arrow-right"></i>`;
                } else {
                    nextBtn.classList.replace('btn-primary', 'btn-success');
                    nextBtn.innerHTML = `Finalizar Curso <i class="ph ph-check"></i>`;
                    nextBtn.onclick = () => {
                        // Save progress for last module
                        const savedProgress = JSON.parse(localStorage.getItem('courseProgress') || '[]');
                        if (!savedProgress.includes(module.id)) {
                            savedProgress.push(module.id);
                            localStorage.setItem('courseProgress', JSON.stringify(savedProgress));
                        }
                        window.location.href = 'courses.html';
                    };
                }

            } catch (error) {
                console.error('Error loading lesson:', error);
                document.getElementById('lessonTitle').textContent = "Error al cargar la lección";
            }
        });
    </script>
</body>

</html>